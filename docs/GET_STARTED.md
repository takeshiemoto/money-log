# Rust入門

## 所有権

何故strは不変でStringは可変か、それはメモリの使い方が違うから。

- strはバイナリにハードコードされ故に高速。
- Stringはコンパイル時に不明の量を確保する必要がある。	

また、StringはOSにメモリの量を要求し、利用し終わったら返却する必要があり、ガベージコレクションが無い場合はアロケートと解放はプログラマが行う必要がある。その場合、以下の問題が起きやすい。

- 解放のタイミングが早い
- 二重解放

Rustはメモリが所有している変数がスコープを抜けると自動で返却する。変数がスコープを抜ける時、dropと呼ばれる関数を呼ぶ。

### Move

s2にs1の参照が入っているのではなく、s1の所有権がs2にmoveしている為、s1は利用できない。

```rust
let s1 = String::from("Hello world");
let s2 = s1;
```

### 可変な参照の制約

特定のスコープで、ある特定のデータに対しては一つしか可変な参照を持てない。データ競合を回避する利点がある。

```rust
let mut s = String::from("hello");

// 1回目
let r1 = &mut s;
// 2回目
let r2 = &mut s;

println!("{}, {}", r1, r2);

```

不変な参照をしている間は、可変な参照をすることはできない。

```rust
let mut s = String::from("hello");

let r1 = &s; // 問題なし
let r2 = &s; // 問題なし
let r3 = &mut s; // 大問題！

```

